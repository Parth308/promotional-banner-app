<!-- File: extensions/promotional-banner/blocks/banner.liquid -->

<div class="promotional-banner" id="promotional-banner-{{ section.id }}" style="
  background: linear-gradient(135deg, #4c1d95 0%, #7c3aed 50%, #a855f7 100%);
  color: white;
  text-align: center;
  padding: 16px 20px;
  font-weight: 500;
  position: relative;
  z-index: 1000;
  margin: 0;
  width: 100%;
  font-family: inherit;
  letter-spacing: 0.3px;
  border: none;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  overflow: hidden;
  transition: transform 0.3s ease, opacity 0.3s ease;
">
  {% if section.settings.enable_animations %}
  <!-- Animated background elements -->
  <div style="
    position: absolute;
    top: -50%;
    left: -10%;
    width: 200px;
    height: 200px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 50%;
    animation: float 6s ease-in-out infinite;
  "></div>
  <div style="
    position: absolute;
    bottom: -30%;
    right: -5%;
    width: 150px;
    height: 150px;
    background: rgba(255, 255, 255, 0.03);
    border-radius: 50%;
    animation: float 8s ease-in-out infinite reverse;
  "></div>
  {% endif %}
  
  <div style="
    position: relative;
    z-index: 2;
    max-width: 1200px;
    margin: 0 auto;
  ">
    <div style="
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    ">
      {% if section.settings.enable_animations %}
      <span style="
        font-size: 18px;
        animation: pulse 2s infinite;
      ">ðŸŽ‰</span>
      {% endif %}
      {{ section.settings.banner_text | default: "ðŸŽ‰ Free Shipping on All Orders! ðŸŽ‰" }}
      {% if section.settings.enable_animations %}
      <span style="
        font-size: 18px;
        animation: pulse 2s infinite;
      ">ðŸŽ‰</span>
      {% endif %}
    </div>
    <div style="
      font-size: 13px;
      font-weight: 400;
      opacity: 0.95;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    ">
      {{ section.settings.sub_text | default: "Limited Time Offer â€¢ Shop Now & Save!" }}
    </div>
  </div>
  
  {% if section.settings.show_close_button %}
  <!-- Desktop Close button (X icon) -->
  <button class="desktop-close-btn" onclick="closeBanner('promotional-banner-{{ section.id }}')" style="
    position: absolute;
    right: 15px;
    top: 50%;
    transform: translateY(-50%);
    background: rgba(255, 255, 255, 0.1);
    border: none;
    color: white;
    width: 28px;
    height: 28px;
    border-radius: 50%;
    cursor: pointer;
    font-size: 16px;
    font-weight: bold;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    opacity: 0.7;
    line-height: 1;
  " onmouseover="this.style.background='rgba(255, 255, 255, 0.2)'; this.style.opacity='1'; this.style.transform='translateY(-50%) scale(1.1)'" onmouseout="this.style.background='rgba(255, 255, 255, 0.1)'; this.style.opacity='0.7'; this.style.transform='translateY(-50%) scale(1)'">
    âœ•
  </button>

  <!-- Mobile Slide Indicator -->
  <div class="mobile-slide-indicator" style="
    position: absolute;
    right: 15px;
    top: 50%;
    transform: translateY(-50%);
    display: none;
    align-items: center;
    gap: 6px;
    color: rgba(255, 255, 255, 0.8);
    font-size: 12px;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    pointer-events: none;
  ">
    <span>Swipe</span>
    <div style="
      display: flex;
      gap: 2px;
    ">
      <div style="
        width: 16px;
        height: 2px;
        background: rgba(255, 255, 255, 0.6);
        border-radius: 1px;
        animation: slideArrow1 2s infinite;
      "></div>
      <div style="
        width: 16px;
        height: 2px;
        background: rgba(255, 255, 255, 0.6);
        border-radius: 1px;
        animation: slideArrow2 2s infinite;
      "></div>
      <div style="
        width: 16px;
        height: 2px;
        background: rgba(255, 255, 255, 0.6);
        border-radius: 1px;
        animation: slideArrow3 2s infinite;
      "></div>
    </div>
  </div>
  {% endif %}
</div>

<style>
  {% if section.settings.enable_animations %}
  @keyframes float {
    0%, 100% { transform: translateY(0px) rotate(0deg); }
    50% { transform: translateY(-20px) rotate(180deg); }
  }
  
  @keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.1); }
  }

  @keyframes slideArrow1 {
    0%, 100% { opacity: 0.3; transform: translateX(0); }
    33% { opacity: 1; transform: translateX(4px); }
    66% { opacity: 0.3; transform: translateX(8px); }
  }

  @keyframes slideArrow2 {
    0%, 100% { opacity: 0.3; transform: translateX(0); }
    33% { opacity: 0.3; transform: translateX(0); }
    50% { opacity: 1; transform: translateX(4px); }
    83% { opacity: 0.3; transform: translateX(8px); }
  }

  @keyframes slideArrow3 {
    0%, 100% { opacity: 0.3; transform: translateX(0); }
    50% { opacity: 0.3; transform: translateX(0); }
    66% { opacity: 1; transform: translateX(4px); }
    100% { opacity: 0.3; transform: translateX(8px); }
  }
  {% endif %}
  
  .promotional-banner:hover {
    transform: translateY(-1px);
    transition: transform 0.3s ease;
  }
  
  .promotional-banner.swiping {
    transition: transform 0.1s ease-out;
  }
  
  .promotional-banner.closing {
    transform: translateY(-100%);
    opacity: 0;
  }
  
  /* Desktop styles */
  @media (min-width: 769px) {
    {% if section.settings.show_close_button %}
    .desktop-close-btn {
      display: flex !important;
    }
    .mobile-slide-indicator {
      display: none !important;
    }
    {% endif %}
  }
  
  /* Mobile styles */
  @media (max-width: 768px) {
    .promotional-banner {
      {% if section.settings.show_close_button %}
      padding: 12px 50px 12px 15px !important;
      {% else %}
      padding: 12px 15px !important;
      {% endif %}
      touch-action: pan-y;
      user-select: none;
    }
    .promotional-banner > div:first-of-type > div:first-child {
      font-size: 14px !important;
    }
    .promotional-banner > div:first-of-type > div:last-child {
      font-size: 11px !important;
    }
    {% if section.settings.show_close_button %}
    .desktop-close-btn {
      display: none !important;
    }
    .mobile-slide-indicator {
      display: flex !important;
    }
    {% endif %}
  }

  /* Tablet styles */
  @media (max-width: 1024px) and (min-width: 769px) {
    .promotional-banner {
      {% if section.settings.show_close_button %}
      padding: 14px 40px 14px 20px !important;
      {% else %}
      padding: 14px 20px !important;
      {% endif %}
    }
  }
</style>

<script>
(function() {
  // Close banner function
  window.closeBanner = function(bannerId) {
    const banner = document.getElementById(bannerId);
    if (banner) {
      banner.classList.add('closing');
      setTimeout(() => {
        banner.style.display = 'none';
      }, 300);
    }
  };

  // Detect if device is mobile
  function isMobileDevice() {
    return window.innerWidth <= 768 || 
           /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
  }

  // Touch/swipe functionality for mobile
  const banner = document.getElementById('promotional-banner-{{ section.id }}');
  const canCloseBanner = {{ section.settings.show_close_button | json }};
  
  if (banner && isMobileDevice() && canCloseBanner) {
    let startX = 0;
    let startY = 0;
    let currentX = 0;
    let currentY = 0;
    let isTracking = false;
    let hasInteracted = false;

    // Hide slide indicator after first interaction
    function hideSlideIndicator() {
      if (!hasInteracted) {
        hasInteracted = true;
        const indicator = banner.querySelector('.mobile-slide-indicator');
        if (indicator) {
          indicator.style.opacity = '0';
          setTimeout(() => {
            indicator.style.display = 'none';
          }, 300);
        }
      }
    }

    // Touch start
    banner.addEventListener('touchstart', function(e) {
      startX = e.touches[0].clientX;
      startY = e.touches[0].clientY;
      currentX = startX;
      currentY = startY;
      isTracking = true;
      banner.classList.add('swiping');
      hideSlideIndicator();
    }, { passive: true });

    // Touch move
    banner.addEventListener('touchmove', function(e) {
      if (!isTracking) return;
      
      currentX = e.touches[0].clientX;
      currentY = e.touches[0].clientY;
      
      const diffX = currentX - startX;
      const diffY = currentY - startY;
      
      // Only track horizontal swipes (both left and right directions)
      // Ignore if vertical movement is too much (user might be scrolling)
      if (Math.abs(diffY) < Math.abs(diffX)) {
        e.preventDefault(); // Prevent scrolling when swiping horizontally
        
        // Handle both left and right swipes
        let translateX;
        if (diffX > 0) {
          // Right swipe
          translateX = Math.min(diffX, banner.offsetWidth);
        } else {
          // Left swipe
          translateX = Math.max(diffX, -banner.offsetWidth);
        }
        
        banner.style.transform = `translateX(${translateX}px)`;
        
        // Add opacity fade effect based on swipe distance
        const swipeDistance = Math.abs(diffX);
        const opacity = Math.max(0.3, 1 - (swipeDistance / (banner.offsetWidth * 0.8)));
        banner.style.opacity = opacity;
      }
    }, { passive: false });

    // Touch end
    banner.addEventListener('touchend', function(e) {
      if (!isTracking) return;
      
      isTracking = false;
      banner.classList.remove('swiping');
      
      const diffX = currentX - startX;
      const diffY = currentY - startY;
      const swipeThreshold = banner.offsetWidth * 0.3; // 30% of banner width
      const swipeDistance = Math.abs(diffX);
      
      // Check if it's a horizontal swipe (not vertical scroll)
      if (Math.abs(diffY) < Math.abs(diffX) && swipeDistance > swipeThreshold) {
        // Close the banner with slide-out animation in the swipe direction
        const slideDirection = diffX > 0 ? banner.offsetWidth : -banner.offsetWidth;
        banner.style.transform = `translateX(${slideDirection}px)`;
        banner.style.opacity = '0';
        banner.style.transition = 'transform 0.3s ease, opacity 0.3s ease';
        setTimeout(() => {
          banner.style.display = 'none';
        }, 300);
      } else {
        // Reset position with smooth animation
        banner.style.transition = 'transform 0.3s ease, opacity 0.3s ease';
        banner.style.transform = '';
        banner.style.opacity = '';
        setTimeout(() => {
          banner.style.transition = '';
        }, 300);
      }
    }, { passive: true });

    // Touch cancel
    banner.addEventListener('touchcancel', function(e) {
      if (!isTracking) return;
      
      isTracking = false;
      banner.classList.remove('swiping');
      banner.style.transition = 'transform 0.3s ease, opacity 0.3s ease';
      banner.style.transform = '';
      banner.style.opacity = '';
      setTimeout(() => {
        banner.style.transition = '';
      }, 300);
    }, { passive: true });

    // Auto-hide slide indicator after 5 seconds if no interaction
    setTimeout(() => {
      if (!hasInteracted) {
        const indicator = banner.querySelector('.mobile-slide-indicator');
        if (indicator) {
          indicator.style.transition = 'opacity 0.5s ease';
          indicator.style.opacity = '0.4';
        }
      }
    }, 5000);
  }

  // Handle window resize to show/hide appropriate controls
  window.addEventListener('resize', function() {
    const banner = document.getElementById('promotional-banner-{{ section.id }}');
    const canCloseBanner = {{ section.settings.show_close_button | json }};
    
    if (banner && canCloseBanner) {
      const desktopBtn = banner.querySelector('.desktop-close-btn');
      const mobileIndicator = banner.querySelector('.mobile-slide-indicator');
      
      if (window.innerWidth <= 768) {
        if (desktopBtn) desktopBtn.style.display = 'none';
        if (mobileIndicator) mobileIndicator.style.display = 'flex';
      } else {
        if (desktopBtn) desktopBtn.style.display = 'flex';
        if (mobileIndicator) mobileIndicator.style.display = 'none';
      }
    }
  });
})();
</script>

{% schema %}
{
  "name": "Promotional Banner",
  "target": "section",
  "settings": [
    {
      "type": "text",
      "id": "banner_text",
      "label": "Main Banner Text",
      "default": "ðŸŽ‰ Free Shipping on All Orders! ðŸŽ‰"
    },
    {
      "type": "text",
      "id": "sub_text",
      "label": "Sub Text",
      "default": "Limited Time Offer â€¢ Shop Now & Save!"
    },
    {
      "type": "checkbox",
      "id": "show_close_button",
      "label": "Show Close Button",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "enable_animations",
      "label": "Enable Animations",
      "default": true
    }
  ]
}
{% endschema %}